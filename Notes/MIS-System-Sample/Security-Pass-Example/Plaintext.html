<html>
<head>
<title>Visual Cryptography</title>
</head>
  <center><h1>Visual Cryptography</h1></center>
<br>
<br>
This page performs visual cryptography.  Enter random keystrokes in the "passphrase" box, type a message in the "message" box, and hit "Make Images".  Then print the two windows named "stream" and "ciphertext".  Hold the two papers up to a light and align them to see the message, which is also shown in the window named "plaintext".  One good way to see the message is to turn off the lights in the room, align the two printouts, and hold them against the computer monitor while displaying something white, such as an empty folder window.
<br><br>
<form name="inp">
<TABLE border=0 cellspacing=0 cellpadding=0 align=center bgcolor=LightGray>
<tr>
  <td width=30>&nbsp;</td>
  <td><b><br>PASSPHRASE:</b></td>
  <td><br><input type=password name="pass" size=50></td>
  <td width=30>&nbsp;</td>
</tr>
<tr>
  <td>&nbsp;</td>
  <td><b>MESSAGE:</b></td>
  <td align=center>
    <textarea name="msg" rows=15 cols=30></textarea>
    <input type=button value="Example" onClick="exampleMsg()">
  </td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td>&nbsp;</td>
  <td><b>SPOT SIZE:</b></td>
  <td align=center>
    <table><tr><td>
     <b>
      <input type="radio" name="s"              value="1"> 1 pixel (illegible)</input><br>
      <input type="radio" name="s"              value="2"> 2 pixels (barely legible, page is 18 lines of 24 characters each)</input><br>
      <input type="radio" name="s" checked=true value="1"> 3 pixels (page is 12 lines of 16 characters each)</input><br>
      <input type="radio" name="s"              value="2"> 6 pixels (page is  6 lines of  8 characters each)</input><br>
      <input type="radio" name="s"              value="3"> 12 pixels (page is  3 lines of  4 characters each)</input><br>
      <input type="radio" name="s"              value="4"> SPECIAL FONT</input>
      (must install David Chaum's 
      <a href=vreceipt.ttf>TrueType font</a>)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;
      <input type="checkbox" name="dark">Use darker lines</input><br>
      &nbsp;&nbsp;&nbsp;&nbsp;
      Size: 
      <select name=fontsize>  
        <option value="1">               1  (7 lines of 10 characters each)
        <option value="2">               2  (5 lines of 7 characters each)
        <option value="3">               3  (4 lines of 6 characters each)
        <option value="4" selected=true> 4  (4 lines of 5 characters each)
        <option value="5">               5  (3 lines of 4 characters each)
        <option value="6">               6  (2 lines of 3 characters each)
        <option value="7">               7  (1 lines of 2 characters each)
      </select><br><br>
     </b>
    </td></tr></table>
  </td>
  <td>&nbsp;</td>
<tr>
  <td width=30>&nbsp;</td>
  <td>&nbsp;</td>
  <td align=center><input type="button" value="Make Images" onClick="drawWindows()"><br>&nbsp;</td>
  <td>&nbsp;</td>
</tr>
</tr>
</table>
</form>

If there are spaces at the ends of the lines, or blank lines at the bottom, that will enlarge the pattern that is generated, and slow down the process.  The given page sizes are for printing in portrait mode with half-inch margins.  The exact size may be different for different browsers and printers.  Generating the two new windows may take many minutes for large messages, such as the example message.  Always use a different passphrase for each message.<br><br>

If you want, you can remember the passphrase, use a message of all spaces, print out the "stream" window, and give that paper to the recipient.  Later, when you have a message to send (with the same number of characters as was used before), you can reenter the same passphrase, enter the message, print out the "Ciphertext" window, and send that to the recipient.  The ciphertext page can be decoded using the stream page that was printed earlier.  <br><br>

The "random" dots on the page are generated by RC4.
<br><br>
<font size=-2>(c) 2000-2009 <a href="http://www.leemon.com">Leemon Baird</a></font><br>

<!--
<b>NOTE:</b> This page contains only open-source crypto code, 
and the BXA was
notified of its existence in accord with 
<a href="http://www.bxa.doc.gov/Encryption/pdfs/Crypto.pdf">this</a>
EAR amendment (p. 2, last column).
-->
<br><br>

<br><br>

<script language="Javascript">

function exampleMsg() {
inp.msg.value=
  " !\"#$%&'()*+,-./\n"+
  "0123456789:;<=>?\n"+
  "@ABCDEFGHIJKLMNO\n"+
  "PQRSTUVWXYZ[\\]^_\n"+
  "`abcdefghijklmno\n"+
  "pqrstuvwxyz{|}~";
}

function swap(i,j) {u=d[i];d[i]=d[j];d[j]=u;}

function drawWindows() {
msgString=inp.msg.value;
if (msgString=="") msgString=" ";
msgString.replace(/\n\r/g,'\n'); //make sure the string uses \n between lines, not \r or \r\n or \n\r
msgString.replace(/\r\n/g,'\n');
msgString.replace(/\r/g,'');

rowsPerChar=11;
colsPerChar=5;
msg=msgString.split("\n");
numRows=msg.length;
numCols=1;
for(i=0;i<numRows;i++) {
  r=msg[i].length;
  if (i<numRows-1) //ignore CR/LF at end of each line other than the last
    r--;
  if (r>numCols)
    numCols=r;
}


numPixels=numCols*numRows*(rowsPerChar+2)*(colsPerChar+2); //total pixels in a picture
rr=new Array(numPixels);
d = new Array(256);

skip=256;
y=inp.pass.value;
if (y=="") y=" ";
y=y+String.fromCharCode(0);   //ensure passphrases X and XX are different, by appending a null to it.
for(i=0;i<256;i++)      d[i]=i;
for(i=j=0;i<256;i++)    swap(i,j=(j+d[i]+y.charCodeAt(i%y.length))&255);  //use passphrase
for(i=j=s=0;s<skip;s++) swap(i=(i+1)&255,j=(j+d[i])&255);                 //skip first 256 bytes of stream
for (s=0;s<numPixels;s++) {   //one bit of ARCFOUR stream per pixel (1 pixel = 1 GIF = 2 black + 2 white spots)
    swap(i=(i+1)&255,j=(j+d[i])&255);
    if (s%8) {  //each byte of stream fills 8 entries of rr[]
      rr[s]=b & 1;
      b=b >> 1;
    } else
      b=d[(d[i]+d[j])&255];  //b is the next byte of the stream
}

for (win=0;win<3;win++) {
  html="<html><head><title>"+(win==1 ? "stream" : win==0 ? "Ciphertext" : "Plaintext")+"</title></head><body><font size="+
       (inp.fontsize.value)+" face=vreceipt><br>";
  rb=0;
  for (j=0;j<numRows;j++) {
    for (c=0;c<numCols*(colsPerChar+2);c++)
      html+=bit(win ^ (rr[rb++]));
    html+='<br>\n\r';
    for (r=0;r<rowsPerChar;r++) {
      for (i=0;i<numCols;i++) {
        html+=bit(win ^ (rr[rb++]));
        for (c=0;c<5;c++) {
          if (i>=msg[j].length)
            ch=0;
          else
            ch=msg[j].charCodeAt(i)-32;  //ASCII code of next character to encrypt, minus 32          
          color=((String)(font[ch*rowsPerChar+r])).substr(c,1)==' '; //true for black, false for white
          html+=bit(rr[rb++]^(color ? win : 0));
        }
        html+=bit(win ^ (rr[rb++]));
      }
      html+='<br>\n\r';
    }
    for (c=0;c<numCols*(colsPerChar+2);c++)
      html+=bit(win ^ (rr[rb++]));
    html+='<br>\n\r';
  }
  html+="</font></body></html>";
  w=open("","ciphertext"+win);
  w.document.write(html);
  w.document.close();
}
}

function bit(b) {
  return   inp.s[0].checked ? (b==1 ? "<img src=a.gif>" : b==0 ? "<img src=b.gif>" : "<img src=k.gif>")
         : inp.s[1].checked ? (b==1 ? "<img src=c.gif>" : b==0 ? "<img src=d.gif>" : "<img src=l.gif>")
         : inp.s[2].checked ? (b==1 ? "<img src=e.gif>" : b==0 ? "<img src=f.gif>" : "<img src=m.gif>")
         : inp.s[3].checked ? (b==1 ? "<img src=g.gif>" : b==0 ? "<img src=h.gif>" : "<img src=n.gif>")
         : inp.s[4].checked ? (b==1 ? "<img src=i.gif>" : b==0 ? "<img src=j.gif>" : "<img src=o.gif>")
         : inp.s[5].checked && !inp.dark.checked ? (b==1 ? "l" : b==0 ? "r" : "B")
         :                                         (b==1 ? "L" : b==0 ? "R" : "B");
}


font=new Array(
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",

"  ## ",
"  ## ",
"  ## ",
"  ## ",
"  ## ",
"  ## ",
"  ## ",
"     ",
"     ",
"  ## ",
"  ## ",

" #  #",
" #  #",
" #  #",
" #  #",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",

" # # ",
" # # ",
" # # ",
"#####",
" # # ",
" # # ",
" # # ",
"#####",
" # # ",
" # # ",
" # # ",

"  #  ",
"#####",
"# #  ",
"# #  ",
"# #  ",
"#####",
"  # #",
"  # #",
"  # #",
"#####",
"  #  ",

"##  #",
"##  #",
"   ##",
"   # ",
"  ## ",
"  #  ",
" ##  ",
" #   ",
"##   ",
"#  ##",
"#  ##",

" ### ",
" # # ",
" ### ",
" #   ",
"###  ",
"# #  ",
"# #  ",
"# ## ",
"#  # ",
"#####",
"    #",

"  #  ",
"  #  ",
"  #  ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",

"   # ",
"  ## ",
" ##  ",
" #   ",
" #   ",
" #   ",
" #   ",
" #   ",
" ##  ",
"  ## ",
"   # ",

" #   ",
" ##  ",
"  ## ",
"   # ",
"   # ",
"   # ",
"   # ",
"   # ",
"  ## ",
" ##  ",
" #   ",

"#   #",
"#   #",
"## ##",
" ### ",
"  #  ",
"#####",
"  #  ",
" ### ",
"## ##",
"#   #",
"#   #",

"     ",
"     ",
"     ",
"  #  ",
"  #  ",
"#####",
"  #  ",
"  #  ",
"     ",
"     ",
"     ",

"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"   # ",
"   # ",
"  ## ",
"###  ",

"     ",
"     ",
"     ",
"     ",
"     ",
"#####",
"     ",
"     ",
"     ",
"     ",
"     ",

"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
" ##  ",
" ##  ",

"    #",
"    #",
"   ##",
"   # ",
"  ## ",
"  #  ",
" ##  ",
" #   ",
"##   ",
"#    ",
"#    ",

"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",

"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",

"#### ",
"#  ##",
"    #",
"    #",
"    #",
"    #",
"   ##",
"  ## ",
" ##  ",
"##   ",
"#####",

"#### ",
"   ##",
"    #",
"   ##",
" ### ",
"##   ",
" ### ",
"   ##",
"    #",
"   ##",
"#### ",

"#    ",
"#    ",
"#  # ",
"#  # ",
"#  # ",
"#####",
"   # ",
"   # ",
"   # ",
"   # ",
"   # ",

"#####",
"#    ",
"#    ",
"#    ",
"#    ",
"#### ",
"   ##",
"    #",
"    #",
"   ##",
"#### ",

" ### ",
"## ##",
"#    ",
"#    ",
"#    ",
"#### ",
"## ##",
"#   #",
"#   #",
"## ##",
" ### ",

"#####",
"    #",
"    #",
"    #",
"    #",
"    #",
"    #",
"    #",
"    #",
"    #",
"    #",

"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",

" ####",
"##  #",
"#   #",
"#   #",
"## ##",
" ####",
"    #",
"    #",
"    #",
"    #",
"    #",

"     ",
"     ",
"  ## ",
"  ## ",
"     ",
"     ",
"  ## ",
"  ## ",
"     ",
"     ",
"     ",

"     ",
"     ",
"  ## ",
"  ## ",
"     ",
"     ",
"     ",
"   # ",
"   # ",
"  ## ",
"###  ",

"     ",
"    #",
"   ##",
"  ## ",
" ##  ",
"##   ",
" ##  ",
"  ## ",
"   ##",
"    #",
"     ",

"     ",
"     ",
"     ",
"#####",
"     ",
"     ",
"#####",
"     ",
"     ",
"     ",
"     ",

"     ",
"#    ",
"##   ",
" ##  ",
"  ## ",
"   ##",
"  ## ",
" ##  ",
"##   ",
"#    ",
"     ",

"#### ",
"#  ##",
"    #",
"    #",
"   ##",
"  ## ",
"  #  ",
"  #  ",
"     ",
"  #  ",
"  #  ",

"#####",
"#   #",
"#   #",
"# # #",
"# # #",
"# # #",
"# ###",
"#    ",
"#    ",
"#   #",
"#####",

"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",

"#### ",
"#  ##",
"#   #",
"#  ##",
"#### ",
"##   ",
"#### ",
"#  ##",
"#   #",
"#  ##",
"#### ",

"  ###",
" ##  ",
"##   ",
"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"##   ",
" ##  ",
"  ###",

"###  ",
"# ## ",
"#  ##",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#  ##",
"# ## ",
"###  ",

"#####",
"#    ",
"#    ",
"#    ",
"#    ",
"#####",
"#    ",
"#    ",
"#    ",
"#    ",
"#####",

"#####",
"#    ",
"#    ",
"#    ",
"#    ",
"#####",
"#    ",
"#    ",
"#    ",
"#    ",
"#    ",

" ### ",
"## ##",
"#    ",
"#    ",
"#    ",
"#    ",
"#  ##",
"#   #",
"#   #",
"## ##",
" ### ",

"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",

"#####",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"#####",

"  ###",
"   # ",
"   # ",
"   # ",
"   # ",
"   # ",
"   # ",
"#  # ",
"#  # ",
"#  # ",
"#### ",

"#   #",
"#  ##",
"#  # ",
"# ## ",
"# #  ",
"###  ",
"# #  ",
"# ## ",
"#  # ",
"#  ##",
"#   #",

"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"#####",

"#   #",
"## ##",
"## ##",
"#####",
"# # #",
"# # #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",

"#   #",
"#   #",
"##  #",
"### #",
"# # #",
"# # #",
"# # #",
"# ###",
"#  ##",
"#   #",
"#   #",

"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",

"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",
"#    ",
"#    ",
"#    ",
"#    ",
"#    ",

"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"# # #",
"# ###",
"#  ##",
"#   #",
"#####",

"#### ",
"#  ##",
"#   #",
"#   #",
"#  ##",
"#### ",
"##   ",
"###  ",
"# ## ",
"#  ##",
"#   #",

" ####",
"##  #",
"#    ",
"#    ",
"##   ",
" ### ",
"   ##",
"    #",
"    #",
"#  ##",
"#### ",

"#####",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",

"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",

"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"## ##",
" # # ",
" # # ",
" ### ",
"  #  ",
"  #  ",

"#   #",
"#   #",
"#   #",
"#   #",
"#   #",
"# # #",
"# # #",
"#####",
"## ##",
"## ##",
"#   #",

"#   #",
"#   #",
"## ##",
" # # ",
" ### ",
"  #  ",
" ### ",
" # # ",
"## ##",
"#   #",
"#   #",

"#   #",
"#   #",
"## ##",
" # # ",
" ### ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",

"#####",
"    #",
"   ##",
"   # ",
"  ## ",
"  #  ",
" ##  ",
" #   ",
"##   ",
"#    ",
"#####",

" ### ",
" #   ",
" #   ",
" #   ",
" #   ",
" #   ",
" #   ",
" #   ",
" #   ",
" #   ",
" ### ",

"#    ",
"#    ",
"##   ",
" #   ",
" ##  ",
"  #  ",
"  ## ",
"   # ",
"   ##",
"    #",
"    #",

" ### ",
"   # ",
"   # ",
"   # ",
"   # ",
"   # ",
"   # ",
"   # ",
"   # ",
"   # ",
" ### ",

"  #  ",
" ### ",
" # # ",
"## ##",
"#   #",
"#   #",
"     ",
"     ",
"     ",
"     ",
"     ",

"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"#####",

"#    ",
"##   ",
" ##  ",
"  #  ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",

"     ",
"     ",
"     ",
"     ",
"    #",
"#####",
"#   #",
"#   #",
"#   #",
"# ###",
"### #",

"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",

"     ",
"     ",
"     ",
"     ",
"     ",
"#####",
"#    ",
"#    ",
"#    ",
"#    ",
"#####",

"    #",
"    #",
"    #",
"    #",
"    #",
"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",

"     ",
"     ",
"     ",
"     ",
"     ",
"#####",
"#   #",
"#####",
"#    ",
"#    ",
"#####",

"  ###",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"#####",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",

"     ",
"     ",
"     ",
"     ",
"     ",
"#####",
"#   #",
"#####",
"    #",
"    #",
"#####",

"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#   #",

"  #  ",
"  #  ",
"     ",
"     ",
"     ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",

"    #",
"    #",
"     ",
"     ",
"     ",
"    #",
"    #",
"    #",
"    #",
"#   #",
"#####",

"#    ",
"#    ",
"#    ",
"#    ",
"#    ",
"#  ##",
"# ## ",
"###  ",
"# #  ",
"# ## ",
"#  ##",

"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",

"     ",
"     ",
"     ",
"     ",
"     ",
" # # ",
"#####",
"# # #",
"# # #",
"#   #",
"#   #",

"     ",
"     ",
"     ",
"     ",
"#    ",
"#### ",
"#  ##",
"#   #",
"#   #",
"#   #",
"#   #",

"     ",
"     ",
"     ",
"     ",
"     ",
"#####",
"#   #",
"#   #",
"#   #",
"#   #",
"#####",

"     ",
"     ",
"     ",
"     ",
"     ",
"#####",
"#   #",
"#####",
"#    ",
"#    ",
"#    ",

"     ",
"     ",
"     ",
"     ",
"     ",
"#### ",
"#  # ",
"#### ",
"   # ",
"   # ",
"   ##",

"     ",
"     ",
"     ",
"     ",
"     ",
"# ###",
"###  ",
"#    ",
"#    ",
"#    ",
"#    ",

"     ",
"     ",
"     ",
"     ",
"     ",
"#####",
"#    ",
"#####",
"    #",
"    #",
"#####",

"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"#####",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"  ###",

"     ",
"     ",
"     ",
"     ",
"     ",
"#   #",
"#   #",
"#   #",
"#   #",
"# ###",
"### #",

"     ",
"     ",
"     ",
"     ",
"     ",
"#   #",
"#   #",
"## ##",
" # # ",
" ### ",
"  #  ",

"     ",
"     ",
"     ",
"     ",
"     ",
"#   #",
"#   #",
"#   #",
"# # #",
"#####",
" # # ",

"     ",
"     ",
"     ",
"     ",
"     ",
"## ##",
" ### ",
"  #  ",
" ### ",
"## ##",
"#   #",

"     ",
"     ",
"     ",
"     ",
"     ",
"#   #",
"#   #",
"#####",
"    #",
"    #",
"#####",

"     ",
"     ",
"     ",
"     ",
"     ",
"#####",
"   ##",
"  ## ",
" ##  ",
"##   ",
"#####",

"   ##",
"   # ",
"   # ",
" ### ",
" #   ",
"##   ",
" #   ",
" ### ",
"   # ",
"   # ",
"   ##",

"     ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"     ",
"  #  ",
"  #  ",
"  #  ",
"  #  ",
"     ",

"##   ",
" #   ",
" #   ",
" ### ",
"   # ",
"   ##",
"   # ",
" ### ",
" #   ",
" #   ",
"##   ",

"    #",
"#####",
"#    ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ",
"     ");

</script>
</body>
</html>
